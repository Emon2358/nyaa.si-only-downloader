name: âš¡ Super Fast Torrent Download & Upload to GigaFileä¾¿

on:
  workflow_dispatch:
    inputs:
      torrent_url:
        description: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ .torrent ã® URL'
        required: true
        default: 'https://sukebei.nyaa.si/download/3957463.torrent'

jobs:
  turbo:
    runs-on: ubuntu-latest

    steps:
      - name: Install minimal tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq aria2 pigz curl python3-pip

      - name: Download via aria2c (max parallel)
        run: |
          mkdir content
          aria2c \
            --dir=content \
            --seed-time=0 \
            --split=16 \
            --max-connection-per-server=16 \
            --max-concurrent-downloads=4 \
            --min-split-size=1M \
            --retry-wait=5 \
            --timeout=60 \
            --summary-interval=1 \
            "${{ github.event.inputs.torrent_url }}"

      - name: Parallel compress with pigz + tar
        run: |
          tar cf - -C content . | pigz -p $(nproc) > download.tar.gz

      - name: Install gfile CLI for GigaFileä¾¿
        run: |
          # gfile: Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¼CLIã€‚uploadã‚³ãƒãƒ³ãƒ‰ã§ã‚®ã‚¬ãƒ•ã‚¡ã‚¤ãƒ«ä¾¿ã¸é€ä¿¡å¯èƒ½
          pip3 install --no-cache-dir git+https://github.com/Sraq-Zit/gfile.git

      - name: Upload to GigaFileä¾¿
        id: upload
        run: |
          # gfile upload ãŒè¿”ã™ URL ã‚’ãã®ã¾ã¾ã‚­ãƒ£ãƒ—ãƒãƒ£
          URL=$(gfile upload download.tar.gz)
          echo "url=$URL" >> $GITHUB_OUTPUT

      - name: Reveal final GigaFileä¾¿ URL
        run: |
          echo "ğŸ‘‰ GigaFileä¾¿ ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã¯ã“ã¡ã‚‰: ${{ steps.upload.outputs.url }}"
