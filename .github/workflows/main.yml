name: âš¡ Super Fast Torrent Download & Upload

on:
  workflow_dispatch:
    inputs:
      torrent_url:
        description: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ .torrent ã® URL'
        required: true
        default: 'https://sukebei.nyaa.si/download/3957463.torrent'

jobs:
  turbo:
    runs-on: ubuntu-latest

    steps:
      # ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ãƒ©ãƒ³ãƒŠãƒ¼ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’é¿ã‘ãŸã„å ´åˆã¯
      # container: docker://ubuntu:22.04 ãªã©ã‚’æŒ‡å®šã—ã¦ã‚‚OK

      - name: Install minimal tools
        run: |
          sudo apt-get update -qq
          sudo apt-get install -y -qq aria2 pigz curl

      - name: Download via aria2c (max parallel)
        run: |
          mkdir content
          aria2c \
            --dir=content \
            --seed-time=0 \
            --split=16 \
            --max-connection-per-server=16 \
            --max-concurrent-downloads=4 \
            --min-split-size=1M \
            --retry-wait=5 \
            --timeout=60 \
            --summary-interval=1 \
            "${{ github.event.inputs.torrent_url }}"

      - name: Parallel compress with pigz + tar
        run: |
          # ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ I/O ã‚’å‰Šæ¸›ã—ã¤ã¤
          tar cf - -C content . | pigz -p $(nproc) > download.tar.gz

      - name: Upload to transfer.sh with progress
        id: upload
        run: |
          URL=$(curl --progress-bar --upload-file download.tar.gz https://transfer.sh/download.tar.gz)
          echo "url=$URL" >> $GITHUB_OUTPUT

      - name: Reveal final URL
        run: |
          echo "ðŸ‘‰ Downloaded & uploaded at maximum speed: ${{ steps.upload.outputs.url }}"
